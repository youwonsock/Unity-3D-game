\hypertarget{_sequenced_channel_8cs_source}{}\doxysection{Sequenced\+Channel.\+cs}
\label{_sequenced_channel_8cs_source}\index{Assets/ConsolePro/Remote/LiteNetLib/SequencedChannel.cs@{Assets/ConsolePro/Remote/LiteNetLib/SequencedChannel.cs}}
\mbox{\hyperlink{_sequenced_channel_8cs}{이 파일의 문서화 페이지로 가기}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00001}00001 \textcolor{keyword}{using }System;}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00002}00002 }
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00003}00003 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespace_flying_worm_console3_1_1_lite_net_lib}{FlyingWormConsole3.LiteNetLib}}}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00004}00004 \{}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00005}00005     \textcolor{keyword}{internal} sealed \textcolor{keyword}{class }SequencedChannel : BaseChannel}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00006}00006     \{}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00007}00007         \textcolor{keyword}{private} \textcolor{keywordtype}{int} \_localSequence;}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00008}00008         \textcolor{keyword}{private} ushort \_remoteSequence;}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00009}00009         \textcolor{keyword}{private} readonly \textcolor{keywordtype}{bool} \_reliable;}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00010}00010         \textcolor{keyword}{private} NetPacket \_lastPacket;}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00011}00011         \textcolor{keyword}{private} readonly NetPacket \_ackPacket;}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00012}00012         \textcolor{keyword}{private} \textcolor{keywordtype}{bool} \_mustSendAck;}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00013}00013         \textcolor{keyword}{private} readonly \textcolor{keywordtype}{byte} \_id;}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00014}00014         \textcolor{keyword}{private} \textcolor{keywordtype}{long} \_lastPacketSendTime;}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00015}00015 }
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00016}00016         \textcolor{keyword}{public} SequencedChannel(NetPeer peer, \textcolor{keywordtype}{bool} reliable, \textcolor{keywordtype}{byte} \textcolor{keywordtype}{id}) : base(peer)}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00017}00017         \{}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00018}00018             \_id = id;}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00019}00019             \_reliable = reliable;}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00020}00020             \textcolor{keywordflow}{if} (\_reliable)}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00021}00021                 \_ackPacket = \textcolor{keyword}{new} NetPacket(PacketProperty.Ack, 0) \{ChannelId = \textcolor{keywordtype}{id}\};}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00022}00022         \}}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00023}00023 }
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00024}00024         \textcolor{keyword}{protected} \textcolor{keyword}{override} \textcolor{keywordtype}{bool} SendNextPackets()}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00025}00025         \{}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00026}00026             \textcolor{keywordflow}{if} (\_reliable \&\& OutgoingQueue.Count == 0)}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00027}00027             \{}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00028}00028                 \textcolor{keywordtype}{long} currentTime = DateTime.UtcNow.Ticks;}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00029}00029                 \textcolor{keywordtype}{long} packetHoldTime = currentTime -\/ \_lastPacketSendTime;}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00030}00030                 \textcolor{keywordflow}{if} (packetHoldTime >= Peer.ResendDelay * TimeSpan.TicksPerMillisecond)}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00031}00031                 \{}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00032}00032                     var packet = \_lastPacket;}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00033}00033                     \textcolor{keywordflow}{if} (packet != \textcolor{keyword}{null})}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00034}00034                     \{}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00035}00035                         \_lastPacketSendTime = currentTime;}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00036}00036                         Peer.SendUserData(packet);}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00037}00037                     \}}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00038}00038                 \}}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00039}00039             \}}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00040}00040             \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00041}00041             \{}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00042}00042                 lock (OutgoingQueue)}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00043}00043                 \{}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00044}00044                     \textcolor{keywordflow}{while} (OutgoingQueue.Count > 0)}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00045}00045                     \{}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00046}00046                         NetPacket packet = OutgoingQueue.Dequeue();}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00047}00047                         \_localSequence = (\_localSequence + 1) \% NetConstants.MaxSequence;}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00048}00048                         packet.Sequence = (ushort)\_localSequence;}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00049}00049                         packet.ChannelId = \_id;}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00050}00050                         Peer.SendUserData(packet);}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00051}00051 }
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00052}00052                         \textcolor{keywordflow}{if} (\_reliable \&\& OutgoingQueue.Count == 0)}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00053}00053                         \{}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00054}00054                             \_lastPacketSendTime = DateTime.UtcNow.Ticks;}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00055}00055                             \_lastPacket = packet;}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00056}00056                         \}}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00057}00057                         \textcolor{keywordflow}{else}}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00058}00058                         \{}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00059}00059                             Peer.NetManager.NetPacketPool.Recycle(packet);}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00060}00060                         \}}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00061}00061                     \}}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00062}00062                 \}}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00063}00063             \}}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00064}00064 }
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00065}00065             \textcolor{keywordflow}{if} (\_reliable \&\& \_mustSendAck)}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00066}00066             \{}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00067}00067                 \_mustSendAck = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00068}00068                 \_ackPacket.Sequence = \_remoteSequence;}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00069}00069                 Peer.SendUserData(\_ackPacket);}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00070}00070             \}}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00071}00071 }
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00072}00072             \textcolor{keywordflow}{return} \_lastPacket != \textcolor{keyword}{null};}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00073}00073         \}}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00074}00074 }
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00075}00075         \textcolor{keyword}{public} \textcolor{keyword}{override} \textcolor{keywordtype}{bool} ProcessPacket(NetPacket packet)}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00076}00076         \{}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00077}00077             \textcolor{keywordflow}{if} (packet.IsFragmented)}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00078}00078                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00079}00079             \textcolor{keywordflow}{if} (packet.Property == PacketProperty.Ack)}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00080}00080             \{}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00081}00081                 \textcolor{keywordflow}{if} (\_reliable \&\& \_lastPacket != \textcolor{keyword}{null} \&\& packet.Sequence == \_lastPacket.Sequence)}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00082}00082                     \_lastPacket = \textcolor{keyword}{null};}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00083}00083                 \textcolor{keywordflow}{return} \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00084}00084             \}}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00085}00085             \textcolor{keywordtype}{int} relative = NetUtils.RelativeSequenceNumber(packet.Sequence, \_remoteSequence);}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00086}00086             \textcolor{keywordtype}{bool} packetProcessed = \textcolor{keyword}{false};}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00087}00087             \textcolor{keywordflow}{if} (packet.Sequence < NetConstants.MaxSequence \&\& relative > 0)}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00088}00088             \{}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00089}00089                 \textcolor{keywordflow}{if} (Peer.NetManager.EnableStatistics) }
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00090}00090                 \{}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00091}00091                     Peer.Statistics.AddPacketLoss(relative -\/ 1);}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00092}00092                     Peer.NetManager.Statistics.AddPacketLoss(relative -\/ 1);}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00093}00093                 \}}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00094}00094 }
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00095}00095                 \_remoteSequence = packet.Sequence;}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00096}00096                 Peer.NetManager.CreateReceiveEvent(}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00097}00097                     packet, }
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00098}00098                     \_reliable ? \mbox{\hyperlink{namespace_flying_worm_console3_1_1_lite_net_lib_a3a62ebbd2dd0421e990b86f328aa90b1}{DeliveryMethod}}.ReliableSequenced : \mbox{\hyperlink{namespace_flying_worm_console3_1_1_lite_net_lib_a3a62ebbd2dd0421e990b86f328aa90b1}{DeliveryMethod}}.Sequenced, }
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00099}00099                     NetConstants.ChanneledHeaderSize,}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00100}00100                     Peer);}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00101}00101                 packetProcessed = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00102}00102             \}}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00103}00103 }
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00104}00104             \textcolor{keywordflow}{if} (\_reliable)}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00105}00105             \{}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00106}00106                 \_mustSendAck = \textcolor{keyword}{true};}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00107}00107                 AddToPeerChannelSendQueue();}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00108}00108             \}}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00109}00109 }
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00110}00110             \textcolor{keywordflow}{return} packetProcessed;}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00111}00111         \}}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00112}00112     \}}
\DoxyCodeLine{\Hypertarget{_sequenced_channel_8cs_source_l00113}00113 \}}

\end{DoxyCode}
